<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">

<link rel="icon" type="image/png" href="favicon/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="favicon/favicon.svg" />
<link rel="shortcut icon" href="favicon/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png" />
<link rel="manifest" href="favicon/site.webmanifest" />

  <title>Цифры на семисегментном индикаторе</title>
  
  <style>
    :root {
      --bg: #f5f7fa;
      --text: #333333;
      --accent: #4a90e2;
      --muted: #666666;
      --radius: 12px;
      --max-width: 800px;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      padding: 3rem 1rem;
    }
    .wrapper {
      max-width: var(--max-width);
      margin: 0 auto;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      color: var(--accent);
    }
    h2 {
      font-size: 1.5rem;
      margin: 2rem 0 0.75rem;
      color: var(--accent);
    }
    p {
      margin-bottom: 1rem;
    }
    ol {
      padding-left: 1.5rem;
    }
	ul {
      padding-left: 1.5rem;
    }
    li {
      margin-bottom: 0.5rem;
	}
	code {
	  font-size: 1rem;
	}
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>Зажигаем цифры на семисегментном индикаторе</h1>
	
	<p>Задача &mdash; отображать переданную через терминал цифру на подключённом к Arduino UNO семисегментном индикаторе с общим катодом.</p>
	
	<h2>Устройство индикатора</h2>
	<p>Семисегментный индикатор представляет собой модуль из семи светодиодов (сегментов) с возможностью формирования цифр и знаков путём включения части сегментов. Все светодиоды соединены внутри модуля одноимённым электродом, например, катодом, который выведен наружу одним выводом; второй электрод каждого светодиода выведен индивидуально. Очень часто в индикаторе есть ещё запятая или точка, так что анодов восемь. Общий катод соединяют с линией GND, а чтобы зажечь сегмент, на его анод через токоограничивающий резистор подают положительный потенциал.</p>
	

    <h2>Принцип</h2>
    <p>Ни в одном из портов B и D нет семи свободных выходов для подключения индикатора, так что шесть сегментов A-F подключим к порту D (пины 2-7), оставшийся сегмент G к порту B (пин 8). В программе для каждой цифры 0-9 предусмотрим схему отображения &mdash; байт, в котором младший (нулевой) бит соответствует сегменту A, первый бит сегменту B, ..., шестой бит сегменту G. Если бит конкретного сегмента равен 1, то соответствующий сегмент светится, иначе погашен. Чтобы отобразить на индикаторе цифру, схему её отображения следует разделить на две части и записать каждую часть в соответствующий порт так, чтобы не повлиять на состояние других линий портов. Перед этим нужно погасить все сегменты.</p>

    <h2>Реализация</h2>
    
	<p>Катоды индикатора через токоограничивающие резисторы подключены к пинам 2-7 и пину 8 Ардуино (соответственно, сегменты A-F и G), аноды к +5 В. На старте программа гасит все сегменты.</p>
	<p>Цифру 0-9, подлежащую отображению, вводят с клавиатуры компьютера в теминале (например, в мониторе последовательного порта Arduino IDE). Программа в микроконтроллере Arduino читает байт из буфера последовательного порта: </p>
	<p><code>char c = Serial.read();</code></p>
	проверяет, была ли введена цифра, и если да, то вычисляет эту цифру, вычитая из кода принятого символа код нуля:</p>
	<p><code>byte n = c - '0';</code></p>
	<p>Далее программа берёт заранее заданную схему отображения принятой цифры (байт) и сдвигом этого байта в соответствующую сторону на соответствующее количество позиций формирует байт для вывода в соответствующий порт.</p>
	
	<h2>Электрическая схема</h2>
	<p><img src="img/030_7seg1.jpg" width=800></p>

    <h2>Файлы</h2>
	<p>Текст программы содержится в файле <code>Ind_y_Ardu.ino</code>, который можно получить с Github <A href="https://github.com/x40in/Ind-y-Ardu/raw/7seg01/Ind_y_Ardu.ino"> по ссылке</A>.</p>
	<p>Как вариант, можно получить с Github весь <A href="https://github.com/x40in/Ind-y-Ardu">репозиторий цикла "Ардуино и индикаторы"</A> и выполнить команду</p>
	<p><code>git restore -s 7seg01 -- Ind_y_Ardu.ino</code></p>
	<p>Файл <code>Ind_y_Ardu.ino</code> в рабочей области будет перезаписан требуемой версией.</p>

    <!--
	<h2>Источники</h2>
    <ol>
	  <li>Alex Gyver. Битовые операции. <A href="https://alexgyver.ru/lessons/bitmath/">https://alexgyver.ru/lessons/bitmath/</A></li>
    </ol> -->
  </div>
</body>
</html>